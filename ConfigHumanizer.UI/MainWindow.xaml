<Window x:Class="ConfigHumanizer.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ConfigHumanizer.UI"
        xmlns:viewModels="clr-namespace:ConfigHumanizer.UI.ViewModels"
        xmlns:converters="clr-namespace:ConfigHumanizer.UI.Converters"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="ConfigHumanizer - Configuration Analyzer"
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource LightBackground}">

    <Window.DataContext>
        <viewModels:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <converters:SeverityToColorConverter x:Key="SeverityToColorConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <!-- Tab Control Style -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border"
                                Background="{StaticResource CardBackground}"
                                BorderBrush="{StaticResource BorderColor}"
                                BorderThickness="1,1,1,0"
                                CornerRadius="6,6,0,0"
                                Margin="2,0"
                                Padding="16,10">
                            <ContentPresenter x:Name="ContentSite"
                                              ContentSource="Header"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource PrimaryColor}" />
                                <Setter TargetName="ContentSite" Property="TextBlock.Foreground" Value="White" />
                                <Setter TargetName="ContentSite" Property="TextBlock.FontWeight" Value="SemiBold" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="ContentSite" Property="TextBlock.Foreground" Value="{StaticResource TextDark}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Modern Toolbar -->
        <Border Grid.Row="0"
                Background="{StaticResource CardBackground}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="15,10">
            <StackPanel Orientation="Horizontal">
                <Button Command="{Binding OpenConfigCommand}"
                        Style="{StaticResource ModernButton}"
                        Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#x1F4C2;" FontSize="14" Margin="0,0,6,0" />
                        <TextBlock Text="Open File" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
                <Button Command="{Binding SaveConfigCommand}"
                        Style="{StaticResource PrimaryButton}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#x1F4BE;" FontSize="14" Margin="0,0,6,0" />
                        <TextBlock Text="Save" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- Tab Control for Main Content -->
        <TabControl Grid.Row="1" Margin="10,10,10,0">

            <!-- Tab 1: Editor & Analysis -->
            <TabItem>
                <TabItem.Header>
                    <TextBlock FontSize="14">
                        <Run Text="&#x1F4DD;" /> Editor &amp; Analysis
                    </TextBlock>
                </TabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="2*" />
                    </Grid.ColumnDefinitions>

                    <!-- Left Panel: Code Editor -->
                    <Border Grid.Column="0"
                            Background="{StaticResource DarkBackground}"
                            Margin="0">
                        <DockPanel>
                            <Border DockPanel.Dock="Top"
                                    Background="#252526"
                                    Padding="12,8">
                                <StackPanel>
                                    <TextBlock Text="Configuration File"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Foreground="#CCCCCC" />
                                    <TextBlock Text="{Binding CurrentFilePath}"
                                               FontSize="11"
                                               Foreground="#808080"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding CurrentFilePath}"
                                               Margin="0,2,0,0" />
                                </StackPanel>
                            </Border>
                            <TextBox Text="{Binding FileContent, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource CodeEditorTextBox}" />
                        </DockPanel>
                    </Border>

                    <!-- Right Panel: Analysis Results -->
                    <Border Grid.Column="1"
                            Background="{StaticResource LightBackground}"
                            Padding="15">
                        <DockPanel>
                            <TextBlock DockPanel.Dock="Top"
                                       Text="Analysis Results"
                                       FontWeight="SemiBold"
                                       FontSize="16"
                                       Foreground="{StaticResource TextDark}"
                                       Margin="5,0,0,15" />
                            <ListView ItemsSource="{Binding Rules}"
                                      BorderThickness="0"
                                      Background="Transparent"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                      ItemContainerStyle="{StaticResource ModernListViewItem}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource CardBorder}"
                                                Background="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}">
                                            <StackPanel>
                                                <!-- Header Row -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding Key}"
                                                               FontWeight="Bold"
                                                               FontSize="15"
                                                               Foreground="{StaticResource TextDark}" />
                                                    <Border Grid.Column="1"
                                                            Background="#80000000"
                                                            CornerRadius="3"
                                                            Padding="8,2">
                                                        <TextBlock Text="{Binding Value}"
                                                                   FontFamily="Consolas"
                                                                   FontSize="12"
                                                                   Foreground="White" />
                                                    </Border>
                                                </Grid>

                                                <!-- Description -->
                                                <TextBlock Text="{Binding HumanDescription}"
                                                           TextWrapping="Wrap"
                                                           Margin="0,8,0,0"
                                                           FontSize="13"
                                                           Foreground="#444444"
                                                           LineHeight="20" />

                                                <!-- Fix Available Section -->
                                                <Border Margin="0,10,0,0"
                                                        Background="#F8F8F8"
                                                        CornerRadius="4"
                                                        Padding="10"
                                                        Visibility="{Binding HasFix, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding FixReason}"
                                                                   TextWrapping="Wrap"
                                                                   FontSize="12"
                                                                   Foreground="#666666"
                                                                   Margin="0,0,0,8" />
                                                        <Button Command="{Binding DataContext.FixCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{StaticResource PrimaryButton}"
                                                                HorizontalAlignment="Left">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="&#x1F6E0;&#xFE0F;" FontSize="12" Margin="0,0,6,0" />
                                                                <TextBlock Text="Apply Fix: " />
                                                                <TextBlock Text="{Binding SuggestedFix}" FontWeight="Bold" />
                                                            </StackPanel>
                                                        </Button>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </DockPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Tab 2: Architecture View -->
            <TabItem>
                <TabItem.Header>
                    <TextBlock FontSize="14">
                        <Run Text="&#x1F5FA;" /> Architecture View
                    </TextBlock>
                </TabItem.Header>
                <Border Background="{StaticResource CardBackground}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        CornerRadius="0,0,6,6">
                    <wv2:WebView2 x:Name="DiagramWebView"
                                  Source="about:blank" />
                </Border>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource PrimaryColor}"
                Padding="15,8">
            <TextBlock Text="{Binding StatusMessage}"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Foreground="{StaticResource TextLight}" />
        </Border>
    </Grid>
</Window>
